<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Overview - {{ owner }}</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header {
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        .portfolio-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .summary-card.positive {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .summary-card.negative {
            background: linear-gradient(135deg, #ee5a52 0%, #f093fb 100%);
        }
        .summary-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .summary-label {
            font-size: 1em;
            opacity: 0.9;
        }
        
        .positions-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .positions-table th {
            background-color: #007bff;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
        }
        .positions-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
        }
        .positions-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        .positions-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .ticker-cell {
            font-weight: bold;
            color: #007bff;
        }
        .positive { color: #28a745; font-weight: bold; }
        .negative { color: #dc3545; font-weight: bold; }
        .neutral { color: #6c757d; }
        
        .alerts-section {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 30px 0;
            border-radius: 5px;
        }
        .risk-alerts {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
            padding: 20px;
            margin: 30px 0;
            border-radius: 5px;
        }
        
        .priority-list {
            background-color: #d1ecf1;
            border-left: 5px solid #17a2b8;
            padding: 20px;
            margin: 30px 0;
            border-radius: 5px;
        }
        .priority-list ul {
            list-style-type: none;
            padding: 0;
        }
        .priority-list li {
            background-color: white;
            margin: 10px 0;
            padding: 12px;
            border-radius: 5px;
            border-left: 4px solid #17a2b8;
        }
        
        .movers-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .movers-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .movers-card h4 {
            margin-top: 0;
            color: #007bff;
        }
        .movers-list {
            list-style-type: none;
            padding: 0;
        }
        .movers-list li {
            padding: 8px;
            margin: 5px 0;
            background-color: white;
            border-radius: 4px;
            border-left: 3px solid #007bff;
        }
        
        .weight-bar {
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        .weight-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
        }
        
        /* AI Insights Section Styles */
        .ai-insights-section {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border-left: 5px solid #007bff;
        }
        
        .insight-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        
        .insight-card h4 {
            margin-top: 0;
            color: #007bff;
            font-size: 1.1em;
        }
        
        .assessment-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #2c3e50;
            font-style: italic;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }
        
        .risk-card {
            border-left-color: #dc3545;
        }
        .risk-card h4 {
            color: #dc3545;
        }
        
        .strategy-card {
            border-left-color: #28a745;
        }
        .strategy-card h4 {
            color: #28a745;
        }
        
        .market-card {
            border-left-color: #ffc107;
        }
        .market-card h4 {
            color: #e68900;
        }
        
        .insight-list, .risk-list, .action-list, .market-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        
        .insight-list li, .risk-list li, .action-list li, .market-list li {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 3px solid #007bff;
        }
        
        .risk-list li {
            background: #fff5f5;
            border-left-color: #dc3545;
        }
        
        .action-list li {
            background: #f0fff4;
            border-left-color: #28a745;
        }
        
        .action-list.immediate li {
            background: #fff3cd;
            border-left-color: #ffc107;
            font-weight: bold;
        }
        
        .market-list li {
            background: #fff9e6;
            border-left-color: #ffc107;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            .summary-grid { grid-template-columns: 1fr; }
            .movers-section { grid-template-columns: 1fr; }
            .positions-table { font-size: 0.9em; }
            .ai-insights-section { padding: 15px; }
            .insight-card { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="portfolio-title">üìä Portfolio Overview</div>
            <div style="font-size: 1.1em; color: #6c757d;">{{ owner }} ‚Ä¢ {{ generated_at }}</div>
        </div>

        <div class="summary-grid">
            <div class="summary-card {{ 'positive' if portfolio_metrics.total_pl_pct >= 0 else 'negative' }}">
                <div class="summary-value">{{ "+" if portfolio_metrics.total_pl_pct >= 0 else "" }}{{ "{:.2f}".format(portfolio_metrics.total_pl_pct) }}%</div>
                <div class="summary-label">Total P/L</div>
            </div>
            <div class="summary-card">
                <div class="summary-value">{{ "{:,.0f}".format(portfolio_metrics.total_value / 1e6) }}M</div>
                <div class="summary-label">Total Value (VND)</div>
            </div>
            <div class="summary-card">
                <div class="summary-value">{{ portfolio_metrics.position_count }}</div>
                <div class="summary-label">Positions</div>
            </div>
            <div class="summary-card">
                <div class="summary-value">{{ "{:.1f}".format(portfolio_metrics.max_position_weight) }}%</div>
                <div class="summary-label">Max Position</div>
            </div>
        </div>

        {% if advisory.risk_alerts %}
        <div class="risk-alerts">
            <h3>‚ö†Ô∏è Risk Alerts</h3>
            <ul>
                {% for alert in advisory.risk_alerts %}
                <li>{{ alert }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if portfolio_metrics.concentration_risks %}
        <div class="alerts-section">
            <h3>üéØ Concentration Risks</h3>
            <ul>
                {% for risk in portfolio_metrics.concentration_risks %}
                <li>{{ risk }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <h3>üíº Current Positions</h3>
        <table class="positions-table">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Value (M VND)</th>
                    <th>P/L %</th>
                    <th>Weight %</th>
                    <th>Position Weight</th>
                </tr>
            </thead>
            <tbody>
                {% for position in portfolio_metrics.positions %}
                <tr>
                    <td class="ticker-cell">{{ position.ticker }}</td>
                    <td>{{ "{:.1f}".format(position.value / 1e6) }}M</td>
                    <td class="{{ 'positive' if position.pl_pct >= 0 else 'negative' }}">
                        {{ "+" if position.pl_pct >= 0 else "" }}{{ "{:.2f}".format(position.pl_pct) }}%
                    </td>
                    <td>{{ "{:.1f}".format(position.weight_pct) }}%</td>
                    <td>
                        <div class="weight-bar">
                            <div class="weight-fill" style="width: {{ position.weight_pct }}%"></div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if portfolio_metrics.top_gainers or portfolio_metrics.top_losers %}
        <div class="movers-section">
            <div class="movers-card">
                <h4>üöÄ Top Gainers</h4>
                {% if portfolio_metrics.top_gainers %}
                <ul class="movers-list">
                    {% for ticker in portfolio_metrics.top_gainers %}
                    <li>{{ ticker }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No gainers today</p>
                {% endif %}
            </div>
            
            <div class="movers-card">
                <h4>üìâ Top Losers</h4>
                {% if portfolio_metrics.top_losers %}
                <ul class="movers-list">
                    {% for ticker in portfolio_metrics.top_losers %}
                    <li>{{ ticker }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No significant losers today</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% if advisory.priority_todos %}
        <div class="priority-list">
            <h3>üìã Priority Actions for Today</h3>
            <ul>
                {% for todo in advisory.priority_todos %}
                <li>{{ todo }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if advisory.overall_assessment %}
        <div class="ai-insights-section">
            <h3>ü§ñ AI Portfolio Insights</h3>
            
            <div class="insight-card">
                <h4>üìä Overall Assessment</h4>
                <p class="assessment-text">{{ advisory.overall_assessment }}</p>
            </div>

            {% if advisory.performance_insights %}
            <div class="insight-card">
                <h4>üìà Performance Analysis</h4>
                {% if advisory.performance_insights.total_pl_analysis %}
                <p><strong>P/L Analysis:</strong> {{ advisory.performance_insights.total_pl_analysis }}</p>
                {% endif %}
                
                {% if advisory.performance_insights.best_performers %}
                <p><strong>üèÜ Best Performers:</strong></p>
                <ul class="insight-list">
                    {% for performer in advisory.performance_insights.best_performers %}
                    <li class="positive">{{ performer }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                {% if advisory.performance_insights.underperformers %}
                <p><strong>‚ö†Ô∏è Underperformers:</strong></p>
                <ul class="insight-list">
                    {% for underperformer in advisory.performance_insights.underperformers %}
                    <li class="negative">{{ underperformer }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% endif %}

            {% if advisory.risk_analysis %}
            <div class="insight-card risk-card">
                <h4>‚ö†Ô∏è Risk Analysis (Score: {{ advisory.risk_analysis.risk_score }}/10)</h4>
                
                {% if advisory.risk_analysis.concentration_risks %}
                <p><strong>üéØ Concentration Risks:</strong></p>
                <ul class="risk-list">
                    {% for risk in advisory.risk_analysis.concentration_risks %}
                    <li>{{ risk }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                {% if advisory.risk_analysis.sector_risks %}
                <p><strong>üè≠ Sector Risks:</strong></p>
                <ul class="risk-list">
                    {% for risk in advisory.risk_analysis.sector_risks %}
                    <li>{{ risk }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% endif %}

            {% if advisory.strategic_recommendations %}
            <div class="insight-card strategy-card">
                <h4>üéØ Strategic Recommendations</h4>
                
                {% if advisory.strategic_recommendations.immediate_actions %}
                <p><strong>üö® Immediate Actions:</strong></p>
                <ul class="action-list immediate">
                    {% for action in advisory.strategic_recommendations.immediate_actions %}
                    <li>{{ action }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                {% if advisory.strategic_recommendations.rebalancing_advice %}
                <p><strong>‚öñÔ∏è Rebalancing Advice:</strong></p>
                <ul class="action-list">
                    {% for advice in advisory.strategic_recommendations.rebalancing_advice %}
                    <li>{{ advice }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                {% if advisory.strategic_recommendations.sector_allocation %}
                <p><strong>üèóÔ∏è Sector Allocation:</strong></p>
                <ul class="action-list">
                    {% for allocation in advisory.strategic_recommendations.sector_allocation %}
                    <li>{{ allocation }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% endif %}

            {% if advisory.market_context %}
            <div class="insight-card market-card">
                <h4>üáªüá≥ Vietnam Market Context</h4>
                
                {% if advisory.market_context.vietnam_market_outlook %}
                <p><strong>Market Outlook:</strong> {{ advisory.market_context.vietnam_market_outlook }}</p>
                {% endif %}
                
                {% if advisory.market_context.sector_trends %}
                <p><strong>üìä Sector Trends:</strong></p>
                <ul class="market-list">
                    {% for trend in advisory.market_context.sector_trends %}
                    <li>{{ trend }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                {% if advisory.market_context.macro_factors %}
                <p><strong>üåê Macro Factors:</strong></p>
                <ul class="market-list">
                    {% for factor in advisory.market_context.macro_factors %}
                    <li>{{ factor }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <div class="footer">
            <p>This portfolio analysis is generated automatically and should not be considered as investment advice. 
               Please conduct your own research and consult with a financial advisor before making investment decisions.</p>
            <p><em>Generated by VN Stock Advisory Notifier</em></p>
        </div>
    </div>
</body>
</html>
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .alert {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Portfolio Overview</h1>
        <p>Total P/L: {{ total_pl }}</p>
        <p>Cash Percentage: {{ cash_percentage }}%</p>
        <h2>Top Movers</h2>
        <ul>
            {% for mover in top_movers %}
                <li>{{ mover }}</li>
            {% endfor %}
        </ul>
        <h2>Risk Alerts</h2>
        <ul>
            {% for alert in risk_alerts %}
                <li class="alert">{{ alert }}</li>
            {% endfor %}
        </ul>
        <h2>Upcoming Events</h2>
        <ul>
            {% for event in upcoming_events %}
                <li>{{ event }}</li>
            {% endfor %}
        </ul>
        <h2>Positions</h2>
        <table>
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Shares</th>
                    <th>Avg Price</th>
                    <th>Current Price</th>
                    <th>P/L %</th>
                </tr>
            </thead>
            <tbody>
                {% for position in positions %}
                    <tr>
                        <td>{{ position.ticker }}</td>
                        <td>{{ position.shares }}</td>
                        <td>{{ position.avg_price }}</td>
                        <td>{{ position.current_price }}</td>
                        <td>{{ position.pl_percentage }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <h2>Action Items</h2>
        <ul>
            {% for todo in action_items %}
                <li>{{ todo }}</li>
            {% endfor %}
        </ul>
    </div>
</body>
</html>